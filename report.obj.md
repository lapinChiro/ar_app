# AR マーカー上の 3D オブジェクト改善 調査レポート

## 現状の課題

現在の `MindARCanvas.tsx` では、`SphereGeometry` + `ConeGeometry` を組み合わせた
簡易魚メッシュ（8 匹）を Boid シミュレーションで動かしている。

**地味に見える要因:**

- プリミティブの組み合わせで「魚」と認識しづらい
- 単色の `MeshStandardMaterial` で特徴がない
- 出現時のトランジションがない（マーカー検出で突然表示）
- 影や環境エフェクトがなく「そこにいる」感が薄い

---

## 選択肢一覧

### 1. GLTF/GLB 3D モデルに置き換え

プリミティブの代わりにプロ品質のローポリ 3D モデルを使う。

**無料モデル入手先:**

| サイト | ライセンス | 特徴 |
|--------|-----------|------|
| [Poly.pizza](https://poly.pizza/) | CC BY 3.0 | ローポリ特化、GLTF 直接 DL |
| [Sketchfab](https://sketchfab.com/features/gltf) | CC0/CC BY 等 | アニメーション付きモデル多数 |
| [Kenney Assets](https://kenney.nl/) | CC0 | テーマ別パック |

**実装:** `GLTFLoader` でロードし、`anchor.group.add(model)` するだけ。
既存の Boid シミュレーションはそのまま流用可能（位置・回転の適用先を変えるだけ）。

```typescript
import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js'
const loader = new GLTFLoader()
loader.load('/models/fish.glb', (gltf) => {
  anchor.group.add(gltf.scene)
  // アニメーション付きなら AnimationMixer で再生
})
```

| 評価軸 | スコア |
|--------|-------|
| 視覚インパクト | 5/5 |
| 実装の複雑さ | 低（GLTFLoader 追加 + load のみ） |
| パフォーマンス | 良好（ローポリ選定が前提） |
| 追加ファイルサイズ | 100-500KB/モデル |

---

### 2. シェーダー・マテリアルの工夫

#### 2a. ホログラフィック・マテリアル

[threejs-vanilla-holographic-material](https://github.com/ektogamat/threejs-vanilla-holographic-material)
を使い、SF 的なホログラム表示にする。フレネル効果・スキャンライン・信号揺らぎを内蔵。
ポストプロセッシング不要でモバイルでも軽量。

| 評価軸 | スコア |
|--------|-------|
| 視覚インパクト | 5/5 |
| 実装の複雑さ | 低（マテリアル差し替えのみ） |
| パフォーマンス | 良好 |
| 追加ファイルサイズ | ~10KB |

#### 2b. トゥーンシェーダー（セルシェーディング）

Three.js 組込みの `MeshToonMaterial` でアニメ調に。追加ライブラリ不要。

| 評価軸 | スコア |
|--------|-------|
| 視覚インパクト | 3/5 |
| 実装の複雑さ | 最低（組込みマテリアル） |
| パフォーマンス | 最良 |
| 追加ファイルサイズ | 0 |

---

### 3. パーティクル・エフェクト

#### 3a. 泡パーティクル（THREE.Points）

500-2000 個の半透明パーティクルを AdditiveBlending で描画。
上方向にゆっくり浮上 + フェードアウト。

#### 3b. キラキラ（InstancedMesh）

小さな光る球を InstancedMesh で大量配置。ドローコール 1 回で済む。

| 評価軸 | スコア |
|--------|-------|
| 視覚インパクト | 4/5 |
| 実装の複雑さ | 低〜中（30-50 行追加） |
| パフォーマンス | 良好（2000 個以下なら 60fps） |
| 追加ファイルサイズ | 0 |

---

### 4. アニメーション改善

#### 4a. 出現アニメーション

マーカー検出時にスケール 0→1 のイージングで出現。現在は突然表示。

#### 4b. GLTF スケルタルアニメーション

モデルに埋め込まれたボーンアニメーション（泳ぎ、ヒレの動き）を
`AnimationMixer` で再生。

#### 4c. プロシージャルアニメーション

浮遊（sin 波）、パルス（脈動）、揺らぎなど。外部ファイル不要。

---

### 5. 環境オブジェクト（海藻・岩・サンゴ）

マーカー面を「海底」と見立て、そこから生える静的オブジェクトを配置する。
魚だけでは空間が寂しいが、海藻や岩があるとシーンに奥行きと世界観が生まれる。

#### 5a. 揺れる海藻（プロシージャル生成）

`TubeGeometry` + `CatmullRomCurve3` で茎を生成し、
頂点シェーダーの sin 波で自然に揺らす。外部ファイル不要。

```typescript
// 海藻の茎を曲線で生成
const curve = new THREE.CatmullRomCurve3([
  new THREE.Vector3(0, 0, 0),
  new THREE.Vector3(0.02, 0.08, 0),
  new THREE.Vector3(-0.01, 0.16, 0),
  new THREE.Vector3(0.01, 0.24, 0),
])
const tube = new THREE.TubeGeometry(curve, 12, 0.006, 6, false)

// 頂点シェーダーで高さに応じた揺れを追加
// pos.x += sin(time + pos.y * 8.0) * pos.y * 0.15
```

**特徴:**

- マーカー面（Y=0）から上に生えるので「紙から飛び出す」効果が自然
- 揺れアニメーションで「水中」感が出る
- 5-10 本配置しても軽量（各 12 セグメント程度）
- GLTF モデルでも代替可能（Poly.pizza に海藻モデルあり）

| 評価軸 | スコア |
|--------|-------|
| 視覚インパクト | 4/5（単体）→ 魚と組み合わせると 5/5 |
| 実装の複雑さ | 低〜中（プロシージャル 40-60 行 / GLTF なら更に簡単） |
| パフォーマンス | 最良（頂点数が極めて少ない） |
| 追加ファイルサイズ | 0（プロシージャル）/ 50-100KB（GLTF） |

#### 5b. 岩・サンゴ（GLTF または IcosahedronGeometry）

海底の地形として岩やサンゴを配置。
`IcosahedronGeometry` のランダム変形で簡易的な岩が作れる。
GLTF モデルなら更にリアルに。

---

### 6. 「紙から飛び出す」演出

マーカー画像を「水面/海底」に見立て、そこから飛び出す演出。

| 演出 | インパクト | 実装難度 |
|------|---------|---------|
| クジラ/イルカが水面からジャンプ | 非常に高い | 中 |
| ポータルリング + 魚が飛び出す | 非常に高い | 中 |
| 宝箱が開いてパーティクル噴出 | 非常に高い | 中〜高 |
| シャドウプレーン（影を落とす） | 高い（接地感） | 低 |

---

## 推奨案の吟味

### パフォーマンス基準（モバイルブラウザ AR）

| 指標 | 目標値 |
|------|-------|
| FPS | 30fps 以上 |
| ドローコール | 100 以下 |
| ポリゴン数合計 | 50,000 以下 |
| GLB ファイルサイズ | 500KB 以下 |

### 比較表

| 案 | インパクト | 工数 | パフォーマンス | 追加サイズ |
|----|---------|------|-------------|----------|
| A. GLTF モデル + Boid | ★★★★★ | 小 | ★★★★ | 300-500KB |
| B. ホログラフィック + プリミティブ | ★★★★★ | 小 | ★★★★ | ~10KB |
| C. GLTF魚 + 海藻 + 泡 + 出現アニメ | ★★★★★ | 中 | ★★★★ | 300-500KB |
| D. クジラジャンプ演出 | ★★★★★ | 中 | ★★★★ | 300-500KB |
| E. ポータルリング + 魚群 | ★★★★★ | 中〜大 | ★★★ | ~10KB |

---

## 最終推奨: 案 C — GLTF 魚 + 揺れる海藻 + 泡パーティクル + 出現アニメーション

**コンセプト: 「マーカーの上に小さな海底世界が出現する」**

マーカー面を海底に見立て、そこから海藻が揺れながら生え、
魚が群れで泳ぎ、泡が浮かび上がる——小さなアクアリウムが紙の上に現れる体験。

**構成要素:**

| 要素 | 役割 | 実装 |
|------|------|------|
| GLTF 魚モデル (8匹) | 主役。Boid 群泳 | GLTFLoader + 既存ロジック流用 |
| 揺れる海藻 (5-8本) | 海底の地面感・水中感 | プロシージャル生成 + sin 波揺れ |
| 泡パーティクル (500個) | 「水の中」の空気感 | THREE.Points + AdditiveBlending |
| 出現アニメーション | 第一印象 | スケール 0→1 イージング |

**理由:**

1. **「海底世界」の世界観が成立する**
   魚だけでは空間が寂しいが、海藻が床から生えていることで
   「ここは海の中」という文脈が自然に伝わる。
   泡が浮かぶことでさらに水中感が強まる。

2. **海藻が「紙から飛び出す」効果を最大化**
   マーカー面（Y=0）から垂直に生える海藻は、
   平面→立体の変化を最もわかりやすく演出する。
   魚は空中を泳ぐが、海藻は「地面に根を張っている」ので接地感が出る。

3. **GLTF モデルで魚の見た目が劇的に向上**
   プリミティブの組み合わせ → プロ品質ローポリモデルで一目で「魚」とわかる。

4. **出現アニメーションで第一印象が変わる**
   マーカー検出時に突然表示 → スケールイージングで「湧き出る」演出に。

5. **既存の Boid シミュレーションをそのまま活用**
   位置・回転の適用先を GLTF モデルに変えるだけ。群泳ロジックの書き直し不要。

6. **パフォーマンス面で安全**
   ローポリモデル + 海藻 8 本 + 泡 500 個なら、
   ローエンドモバイルでも 30fps 以上を維持可能。
